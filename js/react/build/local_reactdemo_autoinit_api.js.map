{
  "version": 3,
  "sources": ["../src/local_reactdemo_autoinit_api.tsx"],
  "sourcesContent": ["import React from \"react\";\nimport { init as autoinit, unmount as autounmount } from \"@moodle/lms/core/react_autoinit\";\n\nconst REGION_ID = \"local-reactdemo-autoinit-region\";\n\n/**\n * Demo component for the core/react_autoinit exposed APIs.\n *\n * @returns A JSX.Element representing the demo UI.\n */\nexport default function AutoInitApiDemo() {\n    const [status, setStatus] = React.useState(\"Idle\");\n    const refreshCountRef = React.useRef(0);\n\n    // Returns the region container where simulated fragment HTML is injected.\n    const getRegion = (): HTMLElement | null => {\n        return document.getElementById(REGION_ID);\n    };\n\n    // Builds mock fragment HTML with data-react-component placeholders.\n    const getFragmentHtml = (fragmentrevision: number): string => {\n        return `\n            <div class=\"small text-muted mb-2\">\n                Simulated Moodle fragment (e.g. refreshed course panel), revision: <strong>${fragmentrevision}</strong>\n            </div>\n            <div\n                data-react-component=\"@local_reactdemo/local_reactdemo_message\"\n                data-react-props='{\"message\":\"Fragment revision ${fragmentrevision} mounted with react_autoinit.init()\"}'\n                class=\"p-2 border rounded mb-2\"\n            >\n                Fallback: message component\n            </div>\n            <div\n                data-react-component=\"@local_reactdemo/local_reactdemo_counter\"\n                data-react-props='{\"initial\":${fragmentrevision}}'\n                class=\"p-2 border rounded mb-2\"\n            >\n                Fallback: counter component\n            </div>\n            <div class=\"small text-muted mb-2\">\n                Note: this counter keeps local React state only. After a fragment refresh/remount, it resets to the new\n                initial value from fragment props (revision).\n            </div>\n            <div\n                data-react-component=\"@local_reactdemo/local_reactdemo_button\"\n                data-react-props='{\"label\":\"Open popup\",\"message\":\"Revision ${fragmentrevision}: popup from mounted fragment button\"}'\n                class=\"p-2 border rounded\"\n            >\n                Fallback: button component\n            </div>\n        `;\n    };\n\n    // Simulates server/fragment HTML injection before calling react_autoinit.init().\n    const renderRawFragment = () => {\n        const region = getRegion();\n        if (!region) {\n            setStatus(\"Region element not found\");\n            return;\n        }\n\n        refreshCountRef.current += 1;\n        region.innerHTML = getFragmentHtml(refreshCountRef.current);\n        setStatus(`Raw fragment HTML injected (revision ${refreshCountRef.current}). Click init() to mount.`);\n    };\n\n    // Mounts data-react-component nodes currently inside the region container.\n    const handleInit = async() => {\n        const region = getRegion();\n        if (!region) {\n            setStatus(\"Region element not found\");\n            return;\n        }\n\n        await autoinit(region);\n        const totalNodes = region.querySelectorAll(\"[data-react-component]\").length;\n        const mountedCount = region.querySelectorAll('[data-react-mounted=\"1\"]').length;\n        setStatus(`Mounted ${mountedCount}/${totalNodes} nodes in current fragment.`);\n    };\n\n    // Fully tears down demo state: unmount roots, clear region DOM, and reset revision.\n    const handleFullCleanup = () => {\n        const region = getRegion();\n        if (region) {\n            autounmount(region);\n            region.innerHTML = \"\";\n        } else {\n            autounmount(`#${REGION_ID}`);\n        }\n        refreshCountRef.current = 0;\n        setStatus(\"Unmounted roots, cleared host, and reset fragment revision.\");\n    };\n\n    // Demonstrates recommended Moodle refresh lifecycle: unmount -> replace HTML -> init.\n    const handleSafeRefresh = async () => {\n        const region = getRegion();\n        if (!region) {\n            setStatus(\"Region element not found\");\n            return;\n        }\n\n        // Real workflow: before replacing a server fragment, cleanup old React roots first.\n        autounmount(region);\n        refreshCountRef.current += 1;\n        region.innerHTML = getFragmentHtml(refreshCountRef.current);\n        await autoinit(region);\n        setStatus(`Safe refresh done for revision ${refreshCountRef.current} (unmount -> replace HTML -> init).`);\n    };\n\n    // Demonstrates risky refresh path where old roots are not explicitly unmounted.\n    const handleUnsafeRefresh = async() => {\n        const region = getRegion();\n        if (!region) {\n            setStatus(\"Region element not found\");\n            return;\n        }\n\n        // Appending a new fragment without cleanup.\n        // This keeps older mounted components alive and visibly duplicates content.\n        refreshCountRef.current += 1;\n        region.insertAdjacentHTML(\"beforeend\", `<hr class=\"my-3\" />${getFragmentHtml(refreshCountRef.current)}`);\n        await autoinit(region);\n        setStatus(\n            `Unsafe refresh revision ${refreshCountRef.current}: appended new fragment without cleanup; old components remain mounted.`\n        );\n    };\n\n    return (\n        <div>\n            <strong>Moodle fragment refresh demo (react_autoinit)</strong>\n            <div className=\"small text-muted mt-1 mb-2\">\n                <p>The react_autoinit exposes two public APIs: <code>init()</code> and <code>unmount()</code></p>\n                <p>Purpose: demonstrate a recommended dynamic-region lifecycle.</p><p>\n                The inject action intentionally uses raw HTML (<code>data-react-component</code> divs), not the Mustache\n                <code>{\"{{#react}}\"}</code> helper, to mimic AJAX/server fragment responses.<br/>\n                The fragment revision value is included to make each refresh visibly different, so you can confirm old\n                content was replaced by a new fragment response.\n                </p>\n            </div>\n            <div className=\"mt-2 mb-2\">{status}</div>\n            <div className=\"d-flex gap-2 mb-2\">\n                <button type=\"button\" className=\"btn btn-secondary btn-sm\" onClick={renderRawFragment}>\n                    1) Inject fragment HTML\n                </button>\n                <button type=\"button\" className=\"btn btn-primary btn-sm\" onClick={handleInit}>\n                    2) Mount current fragment (init)\n                </button>\n                <button type=\"button\" className=\"btn btn-warning btn-sm\" onClick={handleUnsafeRefresh}>\n                    3) Refresh without unmount\n                </button>\n                <button type=\"button\" className=\"btn btn-success btn-sm\" onClick={handleSafeRefresh}>\n                    4) Safe refresh (unmount + init)\n                </button>\n                <button type=\"button\" className=\"btn btn-secondary btn-sm\" onClick={handleFullCleanup}>\n                    5) Full cleanup\n                </button>\n            </div>\n            <div id={REGION_ID} className=\"p-2 border rounded\" />\n        </div>\n    );\n}\n"],
  "mappings": "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",
  "names": []
}
